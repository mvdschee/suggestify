!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).suggestify=e()}(this,(function(){"use strict";function t(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&grave;","/":"&#x2F;"};return t.replace(/[&<>"'/`]/gi,(t=>e[t]))}return class{constructor(e,s){var i,n;this.cache={},this.timeout=200,this.autoSuggest=()=>{this.request(null).catch((t=>{console.error(t)}))},this.inputSelected=e=>{const s=e.target.value,i=s?t(s):null;this.request(i).then((t=>{this.DeleteResultList(),this.createResultList(t)})).catch((t=>{console.error(t)}))},this.searchHandler=e=>{const s=e.target.value,i=s?t(s):null;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.request(i).then((t=>{this.DeleteResultList(),this.createResultList(t)})).catch((t=>{console.error(t)}))}),200)},this.root="string"==typeof e?document.querySelector(e):e,this.url=s.url||"?q=",this.translations=s.translations||null,this.engine=s.engine||"/api/search",this.input=null==(i=this.root)?void 0:i.querySelector("input"),this.list=null==(n=this.root)?void 0:n.querySelector("ul"),this.initialize()}initialize(){var t,e;const s=document.createElement("i");s.setAttribute("role","presentation"),s.setAttribute("focusable","false"),s.setAttribute("aria-hidden","true"),null==(e=this.root)||e.insertBefore(s,null==(t=this.root)?void 0:t.childNodes[0]),this.input&&this.list&&(this.input.setAttribute("role","combobox"),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("spellcheck","false"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-haspopup","listbox"),this.input.setAttribute("aria-expanded","false"),this.list.setAttribute("role","listbox"),this.list.id||(this.list.id=`suggestify-result-${((t=21)=>{let e="",s=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let i=63&s[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e})(5)}`),this.input.setAttribute("aria-owns",this.list.id),this.input.addEventListener("input",this.searchHandler,{passive:!0}),this.input.addEventListener("click",this.inputSelected,{passive:!0}),this.input.addEventListener("mouseover",this.autoSuggest,{once:!0,passive:!0}))}request(t){console.time("request");const e=JSON.stringify(t);if(this.cache[e])return Promise.resolve(this.cache[e]);const s={method:"POST",body:JSON.stringify({search:t})},i=fetch(this.engine,s).then((t=>t.json()));return this.cache[e]=i,console.timeEnd("request"),i}createResultList(t){var e,s,i,n,l,o,r;if(null==(e=this.root)||e.classList.add("active"),t.items.length){if("suggestions"===t.type){const t=document.createElement("li");t.className="suggestify-banner",t.textContent=(null==(s=this.translations)?void 0:s.suggestions)?null==(i=this.translations)?void 0:i.suggestions:"Suggestions:",this.list.appendChild(t)}for(let e=0;e<t.items.length;e++){const s=t.items[e],i=document.createElement("li"),o=document.createElement("a");o.className="suggestify-link",o.setAttribute("aria-label",`${(null==(n=this.translations)?void 0:n.linkLabel)?null==(l=this.translations)?void 0:l.linkLabel:"Search on"} ${s}`),o.href=`${this.url}${s}`,o.textContent=s,i.appendChild(o),this.list.appendChild(i)}}else if("results"===t.type){const t=document.createElement("li");t.className="suggestify-banner",t.textContent=(null==(o=this.translations)?void 0:o.results)?null==(r=this.translations)?void 0:r.results:"No suggestions found",this.list.appendChild(t)}}DeleteResultList(){var t;this.list&&(null==(t=this.root)||t.classList.remove("active"),Array.from(this.list.children).forEach((t=>{this.list.removeChild(t)})))}}}));
