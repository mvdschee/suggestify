!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).suggestify=e()}(this,(function(){"use strict";return class{constructor(t,e){var s,i;this.cache={},this.timeout=200,this.autoSuggest=()=>{this.request(this.searchInput).catch((t=>{throw new Error(t.message)}))},this.handleBlur=()=>{setTimeout((()=>{this.DeleteResultList()}),100)},this.inputSelected=()=>{this.request(this.searchInput).then((t=>{this.DeleteResultList(),this.createResultList(t)})).catch((t=>{throw new Error(t.message)}))},this.EnterHandler=()=>{this.searchInput&&(window.location.href=`${this.url}${this.searchInput}`)},this.keyHandler=({key:t})=>{((t,e="_default")=>s=>(t[s]||t[e])())({Enter:this.EnterHandler,Escape:this.DeleteResultList,_default:()=>null},"_default")(t)},this.searchHandler=({target:t})=>{const e=t.value;this.searchInput=e?function(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&grave;","/":"&#x2F;"};return t.replace(/[&<>"'/`]/gi,(t=>e[t]))}(e):null,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.request(this.searchInput).then((t=>{this.DeleteResultList(),this.createResultList(t)})).catch((t=>{throw new Error(t.message)}))}),200)},this.DeleteResultList=()=>{this.root.classList.remove("active"),this.input.setAttribute("aria-expanded","false"),this.list.innerHTML=""},this.root="string"==typeof t?document.querySelector(t):t,this.url=e.url||"?q=",this.searchInput=null,this.translations=e.translations||null,this.engine=e.engine||"/api/search",this.input=null==(s=this.root)?void 0:s.querySelector("input"),this.list=null==(i=this.root)?void 0:i.querySelector("ul"),this.root&&this.initialize()}initialize(){var t,e;const s=document.createElement("i");if(s.setAttribute("role","presentation"),s.setAttribute("focusable","false"),s.setAttribute("aria-hidden","true"),null==(e=this.root)||e.insertBefore(s,null==(t=this.root)?void 0:t.childNodes[0]),this.input&&this.list){this.input.setAttribute("role","combobox"),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("autocapitalize","off"),this.input.setAttribute("autocorrect","off"),this.input.setAttribute("spellcheck","false"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-haspopup","listbox"),this.input.setAttribute("aria-expanded","false"),this.searchInput=this.input.value,this.list.setAttribute("role","listbox"),this.list.id||(this.list.id=`suggestify-result-${((t=21)=>{let e="",s=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let i=63&s[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e})(5)}`),this.input.setAttribute("aria-owns",this.list.id),this.input.addEventListener("input",this.searchHandler,{passive:!0}),this.input.addEventListener("click",this.inputSelected,{passive:!0}),this.input.addEventListener("keydown",this.keyHandler,{passive:!0}),this.input.addEventListener("mouseover",this.autoSuggest,{once:!0,passive:!0}),this.input.addEventListener("blur",this.handleBlur,{passive:!0});const t=document.createElement("link");t.setAttribute("rel","preconnect"),t.href=this.engine,document.body.appendChild(t)}}async request(t){const e=JSON.stringify(t);if(this.cache[e])return this.cache[e];const s={method:"POST",body:JSON.stringify({search:t})},i=await fetch(this.engine,s).then((t=>t.json()));return this.cache[e]=i,i}createResultList(t){var e,s,i,n,l,r,a,u;if(this.root.classList.add("active"),this.input.setAttribute("aria-expanded","true"),t.items.length){if("suggestions"===t.type){const t=document.createElement("li");t.className="suggestify-banner",t.textContent=(null==(e=this.translations)?void 0:e.suggestions)?null==(s=this.translations)?void 0:s.suggestions:"Suggestions:",this.list.appendChild(t)}for(let e=0;e<t.items.length;e++){const s=t.items[e],l=document.createElement("li"),r=document.createElement("a");r.className="suggestify-link",r.setAttribute("aria-label",`${(null==(i=this.translations)?void 0:i.linkLabel)?null==(n=this.translations)?void 0:n.linkLabel:"Search on"} ${s}`),r.href=`${this.url}${s}`,r.textContent=s,l.appendChild(r),this.list.appendChild(l)}}else if("results"===t.type){const t=document.createElement("li"),e=document.createElement("li"),s=document.createElement("a");t.className="suggestify-banner",t.textContent=(null==(l=this.translations)?void 0:l.results)?null==(r=this.translations)?void 0:r.results:"No suggestions found",s.className="suggestify-link",s.setAttribute("aria-label",`${(null==(a=this.translations)?void 0:a.linkLabel)?null==(u=this.translations)?void 0:u.linkLabel:"Search on"} ${this.searchInput}`),s.href=`${this.url}${this.searchInput}`,s.textContent=this.searchInput,e.appendChild(s),this.list.appendChild(t),this.list.appendChild(e)}}}}));
